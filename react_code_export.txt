// File: frontend/src\App.js
import { BrowserRouter, Route, Routes } from 'react-router-dom';
import Dashboard from "./pages/dashboard";
import Events from "./pages/events";
import Tasks from "./pages/tasks";
import Profile from "./pages/profile";
import Home from "./home";
// import Create from "./buttons/createevent"
import Login from "./authentication/login"
import Signup from "./authentication/signup";
import EditEvent from './events/editevent';
import CreateEvent from './events/createevent';



function App() {
  return (
    <div>
      <BrowserRouter>
        <Routes>
          <Route path="/" element={<Home />} />
          <Route path="/dashboard" element={<Dashboard />} />
          <Route path="/events" element={<Events />} />
          <Route path="/tasks" element={<Tasks />} />
          <Route path="/profile" element={<Profile />} />
          <Route path="/createevent" element={<CreateEvent />} />
          <Route path="/login" element={<Login />} />
          <Route path="/signup" element={<Signup />} />
          <Route path="/editevent/:eventid" element={<EditEvent/>} />
          {/* <Route path="/logout" element={<Logout />} /> */}
        </Routes>
      </BrowserRouter>
    </div>
  );
}

export default App;


// File: frontend/src\home.jsx
import React from 'react';
import { Link } from "react-router-dom";


function Home() {
    return (
        <div className="bg-gray-100">
            <div className="container mx-auto p-20">
                <div className="bg-white p-8 rounded shadow-md mx-52">
                    <h1 className="text-2xl font-bold mb-6">Eventure</h1>
                    <div className="space-y-4">
                        <div>
                            <h2 className="text-lg font-semibold">Register Student Profile</h2>
                            <p>Register as a student to access the student portal of Eventure</p>
                            <Link to="/signup"><button className="mt-2 py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-700">Register your student profile</button>
                            </Link>
                        </div>
                        <div>
                            <h2 className="text-lg font-semibold">Login to Student Portal</h2>
                            <p>Please click the below link to login to the student portal</p>
                            <Link to="/login"><button className="mt-2 py-2 px-4 bg-green-600 text-white rounded hover:bg-green-700">Login to Student Portal</button>
                            </Link>
                        </div>
                        <div>
                            <h2 className="text-lg font-semibold">Login to Admin Portal</h2>
                            <p>Please click the below link to login to the admin portal</p>
                            <button className="mt-2 py-2 px-4 bg-green-600 text-white rounded hover:bg-green-700">Login to Admin Portal</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
}

export default Home;


// File: frontend/src\index.js
import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from "./App"

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <div>
    <App />
  </div>
);

// File: frontend/src\authentication\login.jsx
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import axios from 'axios';

function Login() {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const navigate = useNavigate();

  async function handleLogin(e) {
    e.preventDefault();

    try {
      const response = await axios.post('http://localhost:5000/login', { username, password });
      console.log('API Response:', response.data);

      if (response.data.success) {
        // Store the username, userId, and token in local storage
        localStorage.setItem('username', response.data.username);
        localStorage.setItem('userId', response.data.userId);  // Save userId
        // Navigate to the dashboard
        navigate('/dashboard');
      } else {
        setError(response.data.message || 'Invalid username or password');
      }
    } catch (error) {
      console.error('Login Error:', error);
      setError('An error occurred. Please try again.');
    }
  }

  return (
    <div className="container mx-auto p-20">
      <div className="bg-white p-8 rounded shadow-md mx-52">
        <h1 className="text-2xl font-bold mb-6">Login to Eventure</h1>

        <form onSubmit={handleLogin}>
          <div className="mb-4">
            <label htmlFor="username" className="block mb-2 text-gray-700">Username</label>
            <input
              type="text"
              id="username"
              name="username"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              className="w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500"
              required
            />
          </div>
          <div className="mb-4">
            <label htmlFor="password" className="block mb-2 text-gray-700">Password</label>
            <input
              type="password"
              id="password"
              name="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500"
              required
            />
          </div>
          <div className="mb-4">
            <button
              type="submit"
              className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              Login
            </button>
          </div>
          {error && <div className="text-red-600">{error}</div>}
        </form>
      </div>
    </div>
  );
}

export default Login;


// File: frontend/src\authentication\signup.jsx
import React, { useState } from 'react';
import axios from 'axios';
import { useNavigate } from 'react-router-dom';

function Signup() {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [error, setError] = useState('');
  const navigate = useNavigate();

  const handleSubmit = async (e) => {
    e.preventDefault();

    if (password !== confirmPassword) {
      setError('Passwords do not match.');
      return;
    }

    try {
      const response = await axios.post('http://localhost:5000/signup', { username, password });
      if (response.data.message === "User created successfully") {
        navigate('/login');
      } else {
        setError(response.data.message || 'Signup failed.');
      }
    } catch (error) {
      console.error('There was an error!', error.response ? error.response.data : error.message);
      setError('An error occurred. Please try again.');
    }
  };

  return (
    <div className="container mx-auto p-4">
      <div className="text-center py-4">
        <h1 className="text-2xl">Signup</h1>
      </div>
      <div className="bg-white p-4 mt-4 shadow-sm">
        <form onSubmit={handleSubmit}>
          <div className="mb-4">
            <label htmlFor="username" className="block mb-2">Username</label>
            <input
              type="text"
              id="username"
              name="username"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              className="w-full p-2 border border-gray-300 rounded"
              required
            />
          </div>
          <div className="mb-4">
            <label htmlFor="password" className="block mb-2">Password</label>
            <input
              type="password"
              id="password"
              name="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full p-2 border border-gray-300 rounded"
              required
            />
          </div>
          <div className="mb-4">
            <label htmlFor="confirmPassword" className="block mb-2">Confirm Password</label>
            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              value={confirmPassword}
              onChange={(e) => setConfirmPassword(e.target.value)}
              className="w-full p-2 border border-gray-300 rounded"
              required
            />
          </div>
          <div className="mb-4">
            <button type="submit" className="px-4 py-2 bg-blue-500 text-white rounded">Signup</button>
          </div>
          {error && <div className="text-red-600">{error}</div>}
        </form>
      </div>
    </div>
  );
}

export default Signup;


// File: frontend/src\components\header.jsx
import { Link } from 'react-router-dom';

function Header() {
  const handleLogout = () => {
    localStorage.clear(); // Clear all local storage data
    window.location.href = '/login'; // Redirect to login page
  };

  return (
    <div>
      <nav className="bg-gray-800 text-white p-4 text-center">
        <Link to="/dashboard" className="mx-2">Home</Link>
        <Link to="/events" className="mx-2">Events</Link>
        <Link to="/tasks" className="mx-2">Tasks</Link>
        <Link to="/profile" className="mx-2">Profile</Link>
        <button onClick={handleLogout} className="mx-2">Logout</button>
      </nav>
    </div>
  );
}

export default Header;


// File: frontend/src\events\createevent.jsx
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import axios from 'axios';

function CreateEvent() {
  const [event, setEvent] = useState({
    title: '',
    description: '',
    date: '',
    location: ''
  });
  const navigate = useNavigate();

  const handleChange = (e) => {
    const { name, value } = e.target;
    setEvent((prevEvent) => ({ ...prevEvent, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    console.log('Submitting event:', event); // Log the event data before submission
    try {
      const response = await axios.post('http://localhost:5000/events', event);
      console.log('Response from server:', response.data); // Log the response from the server
      if (response.data.success) {
        navigate('/events');
      } else {
        console.error('Failed to create event:', response.data.message);
      }
    } catch (error) {
      console.error('Error creating event:', error);
    }
  };

  return (
    <div className="container mx-auto p-4">
      <h1 className="text-2xl mb-4">Create New Event</h1>
      <form onSubmit={handleSubmit}>
        <div className="mb-4">
          <label className="block mb-2">Event Name</label>
          <input
            type="text"
            name="title"
            value={event.title}
            onChange={handleChange}
            className="w-full p-2 border border-gray-300 rounded"
          />
        </div>
        <div className="mb-4">
          <label className="block mb-2">Description</label>
          <textarea
            name="description"
            value={event.description}
            onChange={handleChange}
            className="w-full p-2 border border-gray-300 rounded"
          />
        </div>
        <div className="mb-4">
          <label className="block mb-2">Date</label>
          <input
            type="date"
            name="date"
            value={event.date}
            onChange={handleChange}
            className="w-full p-2 border border-gray-300 rounded"
          />
        </div>
        <div className="mb-4">
          <label className="block mb-2">Location</label>
          <input
            type="text"
            name="location"
            value={event.location}
            onChange={handleChange}
            className="w-full p-2 border border-gray-300 rounded"
          />
        </div>
        <button type="submit" className="px-4 py-2 bg-blue-500 text-white rounded">Create Event</button>
      </form>
    </div>
  );
}

export default CreateEvent;

// File: frontend/src\events\editevent.jsx
import React, { useEffect, useState } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import axios from 'axios';

function EditEvent() {
  const { eventid } = useParams();
  const [event, setEvent] = useState({
    title: '',
    description: '',
    date: '',
    location: ''
  });
  const navigate = useNavigate();

  useEffect(() => {
    const fetchEvent = async () => {
      try {
        const response = await axios.get(`http://localhost:5000/events/${eventid}`);
        if (response.data.success) {
          setEvent(response.data.event);
        } else {
          console.error('Failed to fetch event');
        }
      } catch (error) {
        console.error('Error fetching event:', error);
      }
    };

    fetchEvent();
  }, [eventid]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setEvent((prevEvent) => ({ ...prevEvent, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      const response = await axios.put(`http://localhost:5000/events/${eventid}`, event);
      if (response.data.success) {
        navigate('/events');
      } else {
        console.error('Failed to update event');
      }
    } catch (error) {
      console.error('Error updating event:', error);
    }
  };

  return (
    <div className="container mx-auto p-4">
      <h1 className="text-2xl mb-4">Edit Event</h1>
      <form onSubmit={handleSubmit}>
        <div className="mb-4">
          <label className="block mb-2">Event Name</label>
          <input
            type="text"
            name="title"
            value={event.title}
            onChange={handleChange}
            className="w-full p-2 border border-gray-300 rounded"
          />
        </div>
        <div className="mb-4">
          <label className="block mb-2">Description</label>
          <textarea
            name="description"
            value={event.description}
            onChange={handleChange}
            className="w-full p-2 border border-gray-300 rounded"
          />
        </div>
        <div className="mb-4">
          <label className="block mb-2">Date</label>
          <input
            type="date"
            name="date"
            value={event.date}
            onChange={handleChange}
            className="w-full p-2 border border-gray-300 rounded"
          />
        </div>
        <div className="mb-4">
          <label className="block mb-2">Location</label>
          <input
            type="text"
            name="location"
            value={event.location}
            onChange={handleChange}
            className="w-full p-2 border border-gray-300 rounded"
          />
        </div>
        <button type="submit" className="px-4 py-2 bg-blue-500 text-white rounded">Update Event</button>
      </form>
    </div>
  );
}

export default EditEvent;


// File: frontend/src\pages\dashboard.jsx
import React, { useEffect, useState } from 'react';
import Header from '../components/header';
import { Link } from 'react-router-dom';
import axios from 'axios';

function Dashboard() {
  const [events, setEvents] = useState([]);
  const [username, setUsername] = useState('');

  useEffect(() => {
    const fetchEvents = async () => {
      try {
        const response = await axios.get('http://localhost:5000/events');
        if (response.data.success) {
          const now = new Date();
          const upcomingEvents = response.data.events.filter(event => new Date(event.date) >= now);
          setEvents(upcomingEvents);
        } else {
          console.error('Failed to fetch events');
        }
      } catch (error) {
        console.error('Error fetching events:', error);
      }
    };

    // Fetch username from local storage
    const storedUsername = localStorage.getItem('username');
    setUsername(storedUsername || 'Guest');

    fetchEvents();    
  }, []);

  const formatDate = (dateString) => {
    const date = new Date(dateString);
    return date.toISOString().split('T')[0]; // Get the date part only in yyyy-MM-dd format
  };

  return (
    <div>
      <Header />
      <div className="container mx-auto p-4">
        <div className="flex justify-between items-center py-4">
          <h1 className="text-2xl">Welcome, {username}</h1>
          <Link to="/createevent">
            <button className="px-4 py-2 bg-blue-500 text-white rounded">
              Create New Event
            </button>
          </Link>
        </div>
        <div className="bg-white p-4 mt-4 shadow-sm">
          <h2 className="text-xl mb-4">Upcoming Events</h2>
          {events.length > 0 ? (
            events.map((event, index) => (
              <p key={event.eventid}>
                Event {index + 1}: {event.title} - Date: {formatDate(event.date)}
              </p>
            ))
          ) : (
            <p>No upcoming events available</p>
          )}
        </div>
        <div className="bg-white p-4 mt-4 shadow-sm">
          <h2 className="text-xl mb-4">Your Tasks</h2>
          {}
        </div>
      </div>
    </div>
  );
}

export default Dashboard;


// File: frontend/src\pages\events.jsx
import React, { useEffect, useState } from 'react';
import Header from '../components/header';
import { useNavigate } from 'react-router-dom';
import axios from 'axios';

function Events() {
  const [events, setEvents] = useState([]);
  const navigate = useNavigate();

  useEffect(() => {
    const fetchEvents = async () => {
      try {
        const response = await axios.get('http://localhost:5000/events');
        // console.log(response.data)
        if (response.data.success) {
          setEvents(response.data.events);
        } else {
          console.error('Failed to fetch events');
        }
      } catch (error) {
        console.error('Error fetching events:', error);
      }
    };

    fetchEvents();
  }, []);

  const handleEdit = (eventid) => {
    navigate(`/editevent/${eventid}`);
  };

  const handleDelete = async (eventid) => {
    try {
      const response = await axios.delete(`http://localhost:5000/events/${eventid}`);
      if (response.data.success) {
        setEvents(events.filter(event => event.eventid !== eventid));
      } else {
        console.error('Failed to delete event');
      }
    } catch (error) {
      console.error('Error deleting event:', error);
    }
  };

  const formatDate = (dateString) => {
    const date = new Date(dateString);
    return date.toISOString().split('T')[0]; // Get the date part only in yyyy-MM-dd format
  };

  return (
    <div>
      <Header />
      <div className="container mx-auto p-4">
        <div className="text-center py-4">
          <h1 className="text-2xl">Event Details</h1>
        </div>
        {events.map(event => (
          <div key={event.eventid} className="bg-white p-4 mt-4 shadow-sm">
            <div className="mb-4">
              <label className="font-bold">Event Name:</label>
              <div className="ml-1">{event.title}</div>
            </div>
            <div className="mb-4">
              <label className="font-bold">Event Date:</label>
              <div className="ml-1">{formatDate(event.date)}</div>
            </div>
            <div className="mb-4">
              <label className="font-bold">Location:</label>
              <div className="ml-1">{event.location}</div>
            </div>
            <div className="mb-4">
              <label className="font-bold">Description:</label>
              <div className="ml-1">{event.description}</div>
            </div>
            <div className="flex space-x-4">
              <button onClick={() => handleEdit(event.eventid)} className="px-4 py-2 bg-blue-500 text-white rounded">Edit Event</button>
              <button onClick={() => handleDelete(event.eventid)} className="px-4 py-2 bg-red-500 text-white rounded">Delete Event</button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

export default Events;


// File: frontend/src\pages\profile.jsx
import React, { useEffect, useState } from 'react';
import Header from '../components/header';
import axios from 'axios';

function Profile() {
  const [pastEvents, setPastEvents] = useState([]);
  const [currentPassword, setCurrentPassword] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [message, setMessage] = useState('');
  const [userId, setUserId] = useState(null); // Add state for userId

  useEffect(() => {
    // Retrieve userId from local storage
    const storedUserId = localStorage.getItem('userId');
    if (storedUserId) {
      setUserId(storedUserId);
    } else {
      setMessage('User ID not found. Please log in again.');
    }
  }, []);

  const handlePasswordChange = async (e) => {
    e.preventDefault();
    if (newPassword !== confirmPassword) {
      setMessage('New passwords do not match');
      return;
    }

    if (!userId) {
      setMessage('User ID is not available');
      return;
    }

    try {
      const response = await axios.post('http://localhost:5000/changepassword', {
        userId,          
        currentPassword,
        newPassword,
      });
      setMessage(response.data.message);
    } catch (error) {
      console.error('Error changing password:', error);
      setMessage('Error changing password');
    }
  };

  useEffect(() => {
    const fetchEvents = async () => {
      try {
        const response = await axios.get('http://localhost:5000/events');
        if (response.data.success) {
          const now = new Date();
          const pastEventsList = response.data.events.filter(event => new Date(event.date) < now);
          setPastEvents(pastEventsList);
        } else {
          console.error('Failed to fetch events:', response.data.message);
        }
      } catch (error) {
        console.error('Error fetching events:', error);
      }
    };

    fetchEvents();
  }, []);

  const formatDate = (dateString) => {
    const date = new Date(dateString);
    return date.toISOString().split('T')[0]; // Get the date part only in yyyy-MM-dd format
  };

  return (
    <div>
      <Header />
      <div className="container mx-auto p-4">
        <div className="text-center py-4">
          <h1 className="text-2xl">Profile Management</h1>
        </div>

        <div className="bg-white p-4 mt-4 shadow-sm">
          <h2 className="text-xl mb-4">Change Password</h2>
          <form onSubmit={handlePasswordChange}>
            <div className="mb-4">
              <label htmlFor="currentPassword" className="block mb-2">Current Password</label>
              <input
                type="password"
                id="currentPassword"
                name="currentPassword"
                value={currentPassword}
                onChange={(e) => setCurrentPassword(e.target.value)}
                className="w-full p-2 border border-gray-300 rounded"
                required
              />
            </div>
            <div className="mb-4">
              <label htmlFor="newPassword" className="block mb-2">New Password</label>
              <input
                type="password"
                id="newPassword"
                name="newPassword"
                value={newPassword}
                onChange={(e) => setNewPassword(e.target.value)}
                className="w-full p-2 border border-gray-300 rounded"
                required
              />
            </div>
            <div className="mb-4">
              <label htmlFor="confirmPassword" className="block mb-2">Confirm New Password</label>
              <input
                type="password"
                id="confirmPassword"
                name="confirmPassword"
                value={confirmPassword}
                onChange={(e) => setConfirmPassword(e.target.value)}
                className="w-full p-2 border border-gray-300 rounded"
                required
              />
            </div>
            <div className="mb-4">
              <button
                type="submit"
                className="px-4 py-2 bg-blue-500 text-white rounded"
                disabled={!userId} // Disable button if userId is not available
              >
                Change Password
              </button>
            </div>
          </form>
          {message && <p className="text-red-500">{message}</p>}
        </div>

        <div className="bg-white p-4 mt-4 shadow-sm">
          <h2 className="text-xl mb-4">Past Events and Activities</h2>
          {pastEvents.length > 0 ? (
            <ul className="list-disc pl-5">
              {pastEvents.map((event, index) => (
                <li key={event.eventid}>
                  Event {index + 1}: {event.title} - Date: {formatDate(event.date)}
                </li>
              ))}
            </ul>
          ) : (
            <p>No past events available</p>
          )}
        </div>
      </div>
    </div>
  );
}

export default Profile;


// File: frontend/src\pages\tasks.jsx
import React, { useState, useEffect } from 'react';
import Header from '../components/header';
import axios from 'axios';

const Tasks = () => {
  const [taskTitle, setTaskTitle] = useState('');
  const [taskDescription, setTaskDescription] = useState('');
  const [taskDeadline, setTaskDeadline] = useState('');
  const [selectedEvent, setSelectedEvent] = useState('');
  const [selectedAssignee, setSelectedAssignee] = useState('');
  const [taskStatus, setTaskStatus] = useState('');
  const [events, setEvents] = useState([]);
  const [users, setUsers] = useState([]);

  useEffect(() => {
    const fetchEvents = async () => {
      try {
        const response = await axios.get('http://localhost:5000/events');
        setEvents(response.data.events);
      } catch (error) {
        console.error('Error fetching events:', error);
      }
    };

    const fetchUsers = async () => {
      try {
        const response = await axios.get('http://localhost:5000/users');
        setUsers(response.data.users);
      } catch (error) {
        console.error('Error fetching users:', error);
      }
    };

    fetchEvents();
    fetchUsers();
  }, []);

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      await axios.post('http://localhost:5000/tasks', {
        title: taskTitle,
        description: taskDescription,
        deadline: taskDeadline,
        eventid: selectedEvent,
        assigneeid: selectedAssignee,
        status: taskStatus,
      });
      alert('Task created successfully');
      // Clear form fields
      setTaskTitle('');
      setTaskDescription('');
      setTaskDeadline('');
      setSelectedEvent('');
      setSelectedAssignee('');
      setTaskStatus('');
    } catch (error) {
      console.error('Error creating task:', error);
      alert('Error creating task');
    }
  };

  return (
    <div><Header />
    <div className="container mx-auto p-4">
      
      <h1 className="text-2xl font-bold mb-4">Create New Task</h1>
      <form onSubmit={handleSubmit} className="space-y-4">
      <div>
          <label htmlFor="event" className="block text-sm font-medium text-gray-700">Related Event</label>
          <select
            id="event"
            value={selectedEvent}
            onChange={(e) => setSelectedEvent(e.target.value)}
            className="mt-1 block w-full p-2 border border-gray-300 rounded"
            required
          >
            <option value="">Select an Event</option>
            {events.map((event) => (
              <option key={event.eventid} value={event.eventid}>
                {event.title}
              </option>
            ))}
          </select>
        </div>
        <div>
          <label htmlFor="title" className="block text-sm font-medium text-gray-700">Title</label>
          <input
            id="title"
            type="text"
            value={taskTitle}
            onChange={(e) => setTaskTitle(e.target.value)}
            className="mt-1 block w-full p-2 border border-gray-300 rounded"
            required
          />
        </div>
        <div>
          <label htmlFor="description" className="block text-sm font-medium text-gray-700">Description</label>
          <input
            id="description"
            type="text"
            value={taskDescription}
            onChange={(e) => setTaskDescription(e.target.value)}
            className="mt-1 block w-full p-2 border border-gray-300 rounded"
            required
          />
        </div>
        <div>
          <label htmlFor="deadline" className="block text-sm font-medium text-gray-700">Deadline</label>
          <input
            id="deadline"
            type="date"
            value={taskDeadline}
            onChange={(e) => setTaskDeadline(e.target.value)}
            className="mt-1 block w-full p-2 border border-gray-300 rounded"
            required
          />
        </div>
 
        <div>
          <label htmlFor="assignee" className="block text-sm font-medium text-gray-700">Assignee</label>
          <select
            id="assignee"
            value={selectedAssignee}
            onChange={(e) => setSelectedAssignee(e.target.value)}
            className="mt-1 block w-full p-2 border border-gray-300 rounded"
            required
          >
            <option value="">Select an Assignee</option>
            {users.map((user) => (
              <option key={user.userid} value={user.userid}>
                {user.username}
              </option>
            ))}
          </select>
        </div>
        <button type="submit" className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
          Create Task
        </button>
      </form>
    </div>
    </div>
  );
};

export default Tasks;


// File: backend\index.js
const express = require("express");
const cors = require("cors");
const connectDB = require("./config/db");
const User = require("./models/user");
const Event = require("./models/event");
const { getNextUserId} = require('./utils/idUtils');

const app = express();
app.use(cors());
app.use(express.json());

// Connect to MongoDB
connectDB();



// Signup Route
app.post("/signup", async (req, res) => {
  try {
    const { username, password } = req.body;

    // Validate that both fields are provided
    if (!username || !password) {
      return res.status(400).json({ message: "Username and password are required" });
    }

    // Check if the user already exists
    const existingUser = await User.findOne({ username });

    if (existingUser) {
      return res.status(400).json({ message: "Username already exists" });
    }

    // Get the next user ID
    const nextUserId = await getNextUserId();

    // Create a new user
    const newUser = new User({ userid: nextUserId, username, password });
    await newUser.save();

    res.status(201).json({ message: "User created successfully" });
  } catch (error) {
    console.error('Error during signup:', error);
    res.status(500).json({ message: "Error creating user", error });
  }
});

app.post("/login", async (req, res) => {
  try {
    const { username, password } = req.body;

    const foundUser = await User.findOne({ username });

    if (foundUser) {
      if (foundUser.password === password) {
        res.json({
          success: true,
          username: foundUser.username,
          userId: foundUser._id,  // Include userId in the response
        });
      } else {
        res.json({ success: false, message: "Incorrect password" });
      }
    } else {
      res.json({ success: false, message: "User not found" });
    }
  } catch (error) {
    console.error('Error during login:', error);
    res.status(500).json({ message: "Error checking user", error });
  }
});

app.post('/changepassword', async (req, res) => {
  const { userId, currentPassword, newPassword } = req.body; // Retrieve userId from request body

  try {
    const user = await User.findById(userId);
    if (!user) {
      return res.status(404).json({ message: 'User not found' });
    }

    if (currentPassword !== user.password) {
      return res.status(400).json({ message: 'Current password is incorrect' });
    }

    user.password = newPassword;
    await user.save();

    res.json({ message: 'Password changed successfully' });
  } catch (error) {
    res.status(500).json({ message: 'Server error' });
  }
});

const eventRoutes = require("./routes/eventRoutes");
app.use("/events", eventRoutes);

const userRoutes = require('./routes/userRoutes');
app.use('/users', userRoutes);

const taskRoutes = require('./routes/taskRoutes');
app.use('/tasks', taskRoutes);



const PORT = 5000;
app.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
});


// File: backend\config\db.js
const mongoose = require("mongoose");

const connectDB = async () => {
    try {
        await mongoose.connect("mongodb://127.0.0.1:27017/eventuretwo");
        console.log("DB connection successful");
    } catch (error) {
        console.error("DB connection failed", error);
    }
};

module.exports = connectDB;


// File: backend\controllers\eventController.js
const Event = require("../models/event");
const { getNextEventId } = require("../utils/idUtils");


const createEvent = async (req, res) => {
  try {
    const { title, description, date, location } = req.body;

    if (!title || !description || !date || !location) {
      return res.status(400).json({ success: false, message: 'All required fields must be filled' });
    }

    const eventid = await getNextEventId();
    const newEvent = new Event({ eventid, title, description, date, location });
    await newEvent.save();
    res.status(201).json({ success: true, message: 'Event created successfully' });
  } catch (error) {
    console.error('Error creating event:', error);
    res.status(500).json({ success: false, message: 'Error creating event', error });
  }
};

const getAllEvents = async (req, res) => {
  try {
    const events = await Event.find();
    res.json({ success: true, events });
  } catch (error) {
    res.status(500).json({ message: "Error fetching events", error });
  }
};

const getSingleEvent = async (req, res) => {
  try {
    const event = await Event.findOne({ eventid: req.params.id });
    if (event) {
      res.json({ success: true, event });
    } else {
      res.status(404).json({ success: false, message: "Event not found" });
    }
  } catch (error) {
    res.status(500).json({ message: "Error fetching event", error });
  }
};

const updateEvent = async (req, res) => {
  try {
    const { title, description, date, location } = req.body;
    const updatedEvent = await Event.findOneAndUpdate(
      { eventid: req.params.id },
      { title, description, date, location },
      { new: true }
    );
    if (updatedEvent) {
      res.json({ success: true, message: "Event updated successfully", event: updatedEvent });
    } else {
      res.status(404).json({ success: false, message: "Event not found" });
    }
  } catch (error) {
    res.status(500).json({ message: "Error updating event", error });
  }
};

const deleteEvent = async (req, res) => {
  try {
    const deletedEvent = await Event.findOneAndDelete({ eventid: req.params.id });
    if (deletedEvent) {
      res.json({ success: true, message: "Event deleted successfully" });
    } else {
      res.status(404).json({ success: false, message: "Event not found" });
    }
  } catch (error) {
    res.status(500).json({ message: "Error deleting event", error });
  }
};

module.exports = { createEvent, getAllEvents, getSingleEvent, updateEvent, deleteEvent };


// File: backend\controllers\taskController.js
const Task = require('../models/task');
const User = require('../models/user');
const { getNextTaskId } = require('../utils/idUtils');

const createTask = async (req, res) => {
  try {
    const { title, description, deadline, eventid, assigneeid } = req.body;

    if (!title || !description || !deadline || !eventid || !assigneeid) {
      return res.status(400).json({ success: false, message: 'All fields are required' });
    }

    // Get the next task ID
    const taskid = await getNextTaskId();
    const newTask = new Task({ taskid, title, description, deadline, eventid, assigneeid });
    await newTask.save();

    // Update the user with the new task ID
    await User.findOneAndUpdate(
      { userid: assigneeid },
      { $push: { task_ids: taskid } }
    );

    res.status(201).json({ success: true, message: 'Task created successfully', task: newTask });
  } catch (error) {
    console.error('Error creating task:', error);
    res.status(500).json({ success: false, message: 'Error creating task', error });
  }
};

const getTasksByUser = async (req, res) => {
  try {
    const userId = req.params.userid;
    const tasks = await Task.find({ assigneeid: userId });
    res.json({ success: true, tasks });
  } catch (error) {
    console.error('Error fetching tasks:', error);
    res.status(500).json({ message: 'Error fetching tasks', error });
  }
};

module.exports = { createTask, getTasksByUser };


// File: backend\controllers\userController.js
const User = require('../models/user');

const getAllUsers = async (req, res) => {
  try {
    const users = await User.find();
    res.json({ success: true, users });
  } catch (error) {
    console.error('Error fetching users:', error);
    res.status(500).json({ message: 'Error fetching users', error });
  }
};

module.exports = { getAllUsers };


// File: backend\models\event.js
const mongoose = require('mongoose');

const eventSchema = new mongoose.Schema({
  eventid: { type: Number, required: true, unique: true },
  title: { type: String, required: true },
  description: { type: String, required: true },
  date: { type: Date, required: true },
  location: { type: String, required: true }
  // userid: { type: Number, ref: 'User', required: true },  // Reference to User collection
  // task_ids: [{ type: Number, ref: 'Task' }],  // Array of task IDs
  // participant_ids: [{ type: Number, ref: 'Participant' }]  // Array of participant IDs
});

const Event = mongoose.model('Event', eventSchema);

module.exports = Event;


// File: backend\models\participant.js
const mongoose = require('mongoose');

const participantSchema = new mongoose.Schema({
  participantid: { type: Number, required: true, unique: true },
  userid: { type: Number, ref: 'User', required: true },  // Reference to User collection
  eventid: { type: Number, ref: 'Event', required: true },  // Reference to Event collection
  role: { type: String, required: true }
});

const Participant = mongoose.model('Participant', participantSchema);

module.exports = Participant;


// File: backend\models\task.js
const mongoose = require('mongoose');

const taskSchema = new mongoose.Schema({
  taskid: { type: Number, required: true, unique: true },
  title: { type: String, required: true },
  description: { type: String, required: true },
  deadline: { type: Date, required: true },
  eventid: { type: Number, ref: 'Event', required: true },
  assigneeid: { type: Number, ref: 'User', required: true }
});

const Task = mongoose.model('Task', taskSchema);

module.exports = Task;


// File: backend\models\user.js
const mongoose = require('mongoose');

const userSchema = new mongoose.Schema({
  userid: { type: Number, required: true, unique: true },
  username: { type: String, required: true, unique: true },
  password: { type: String, required: true },
  task_ids: [{ type: Number, ref: 'Task' }],  // Array of task IDs
  participating_event_ids: [{ type: Number, ref: 'Event' }]  // Array of event IDs
});

const User = mongoose.model('User', userSchema);

module.exports = User;

// File: backend\routes\eventRoutes.js
const express = require('express');
const { createEvent, getAllEvents, getSingleEvent, updateEvent, deleteEvent } = require('../controllers/eventController');

const router = express.Router();

router.post('/', createEvent);
router.get('/', getAllEvents);
router.get('/:id', getSingleEvent);
router.put('/:id', updateEvent);
router.delete('/:id', deleteEvent);

module.exports = router;


// File: backend\routes\taskRoutes.js
const express = require('express');
const router = express.Router();
const { createTask, getTasksByUser } = require('../controllers/taskController');

router.post('/', createTask);
router.get('/user/:userid', getTasksByUser);

module.exports = router;


// File: backend\routes\userRoutes.js
const express = require('express');
const { getAllUsers } = require('../controllers/userController');

const router = express.Router();

router.get('/', getAllUsers);

module.exports = router;


// File: backend\utils\idUtils.js
const mongoose = require('mongoose');
const Task = require('../models/task');
const Event = require('../models/event'); // Add this line

// Utility function to get the next task ID
const getNextTaskId = async () => {
  try {
    const lastTask = await Task.findOne().sort({ taskid: -1 });
    return lastTask ? lastTask.taskid + 1 : 1;
  } catch (error) {
    console.error('Error getting next task ID:', error);
    throw new Error('Could not get the next task ID');
  }
};

// Existing utility functions
const getNextEventId = async () => {
  const lastEvent = await Event.findOne().sort({ eventid: -1 });
  return lastEvent ? lastEvent.eventid + 1 : 1;
};

const getNextUserId = async () => {
  try {
    const lastUser = await User.findOne().sort({ userid: -1 });
    return lastUser ? lastUser.userid + 1 : 1;
  } catch (error) {
    console.error('Error getting next user ID:', error);
    throw new Error('Could not get the next user ID');
  }
};




module.exports = { getNextTaskId, getNextEventId, getNextUserId };


